From fb6f0a4c30f79e81a38b3244776ac248bf2766b2 Mon Sep 17 00:00:00 2001
From: Pierre-Hugues Husson <phh@phh.me>
Date: Wed, 17 Apr 2024 04:49:18 -0400
Subject: [PATCH 43/44] Don't crash system_server if we fail to parse dynamic
 udfps position

---
 .../sensors/fingerprint/aidl/FingerprintProvider.java         | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/services/core/java/com/android/server/biometrics/sensors/fingerprint/aidl/FingerprintProvider.java b/services/core/java/com/android/server/biometrics/sensors/fingerprint/aidl/FingerprintProvider.java
index 5c822095bee4..d00e3eb30a20 100644
--- a/services/core/java/com/android/server/biometrics/sensors/fingerprint/aidl/FingerprintProvider.java
+++ b/services/core/java/com/android/server/biometrics/sensors/fingerprint/aidl/FingerprintProvider.java
@@ -261,6 +261,7 @@ android.util.Log.e("PHH-Enroll", "Poping AIDL fp provider");
                     android.util.Log.e("PHH-Enroll", " - " + loc.sensorLocationX + ", " + loc.sensorLocationY + ", " +loc.sensorRadius + ", disp =" + loc.display + ", shape " + loc.sensorShape);
                 }
                 if (locations.length == 1 && locations[0].sensorLocationX == 0) {
+                try {
                     int[] otherValues = com.android.server.biometrics.AuthService.dynamicUdfpsProps(context);
                     if (otherValues.length > 0) {
                         SensorLocation loc = new SensorLocation();
@@ -269,6 +270,9 @@ android.util.Log.e("PHH-Enroll", "Poping AIDL fp provider");
                         loc.sensorRadius = otherValues[2];
                         locations[0] = loc;
                     }
+                } catch(Throwable t) {
+                    android.util.Log.e("PHH-Enroll", "FingerprintProvider dynamicUdfpsProps", t);
+                    }
                 }
 
                 android.util.Log.e("PHH-Enroll", "Got fp props -- post");
-- 
2.34.1

